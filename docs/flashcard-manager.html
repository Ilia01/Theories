<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard Manager</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>

<body>
    <!-- Header Toolbar -->
    <div id="header-toolbar">
        <button id="back-to-topic" aria-label="Back to topic" title="Back to Topic">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="dark-mode-toggle" aria-label="Toggle dark mode" title="Toggle Dark Mode (Cmd+D)">
            <i id="dark-mode-icon" class="fas fa-moon"></i>
        </button>
    </div>

    <!-- Progress Bar -->
    <div id="progress-bar">
        <div id="progress-fill"></div>
    </div>

    <!-- Main Content -->
    <main id="flashcard-manager-page">
        <div class="flashcard-manager-header">
            <h1><i class="fas fa-layer-group"></i> Flashcards</h1>
            <p id="topic-title">Loading...</p>
        </div>

        <div class="flashcard-stats">
            <div class="stat-item">
                <i class="fas fa-layer-group"></i>
                <span id="total-cards">0</span> cards
            </div>
            <div class="stat-item">
                <i class="fas fa-check-circle"></i>
                <span id="mastered-cards">0</span> mastered
            </div>
            <div class="stat-item">
                <i class="fas fa-redo"></i>
                <span id="review-cards">0</span> to review
            </div>
        </div>

        <div class="flashcard-actions">
            <button id="auto-generate-btn" class="action-btn primary">
                <i class="fas fa-magic"></i> Auto-Generate
            </button>
            <button id="study-due-btn" class="action-btn primary">
                <i class="fas fa-clock"></i> Study Due (<span id="due-count">0</span>)
            </button>
            <button id="study-all-btn" class="action-btn">
                <i class="fas fa-brain"></i> Study All
            </button>
            <button id="add-flashcard-btn" class="action-btn">
                <i class="fas fa-plus"></i> Add Card
            </button>
        </div>

        <div class="flashcard-list" id="flashcard-list"></div>
    </main>

    <!-- Auto-Generate Confirmation Modal -->
    <div id="generate-modal" class="modal">
        <div class="modal-content generate-content">
            <div class="modal-header">
                <h2><i class="fas fa-magic"></i> Auto-Generate Flashcards</h2>
                <button id="generate-close" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="generate-body">
                <!-- AI Toggle -->
                <div class="ai-toggle-section">
                    <label class="toggle-label">
                        <input type="checkbox" id="use-ai-toggle">
                        <span class="toggle-text">
                            <i class="fas fa-robot"></i> Use AI-Powered Generation
                            <small>(More diverse & intelligent questions)</small>
                        </span>
                    </label>
                </div>

                <!-- AI Settings (shown when toggle is ON) -->
                <div id="ai-settings-section" class="ai-settings hidden">
                    <div class="form-group">
                        <label for="ai-provider-select">AI Provider:</label>
                        <select id="ai-provider-select">
                            <option value="groq" selected>Groq (Recommended - Free & Fast)</option>
                            <option value="gemini">Google Gemini</option>
                            <option value="huggingface">Hugging Face</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="ai-api-key-input">
                            API Key:
                            <a href="#" id="get-api-key-link" target="_blank" class="help-link">
                                <i class="fas fa-external-link-alt"></i> Get Free Key
                            </a>
                        </label>
                        <input type="password" id="ai-api-key-input" placeholder="Enter your API key">
                        <small class="help-text">Your key is stored locally and never shared</small>
                    </div>

                    <div class="form-group">
                        <label for="questions-per-section">Questions per Section:</label>
                        <input type="number" id="questions-per-section" value="3" min="1" max="10">
                    </div>

                    <div class="form-group">
                        <label for="question-diversity">Question Diversity:</label>
                        <select id="question-diversity">
                            <option value="low">Low (Similar questions)</option>
                            <option value="medium">Medium (Balanced)</option>
                            <option value="high" selected>High (Maximum variety)</option>
                        </select>
                    </div>

                    <button id="test-ai-connection" class="action-btn">
                        <i class="fas fa-plug"></i> Test Connection
                    </button>
                    <div id="ai-test-result" class="test-result hidden"></div>
                </div>

                <!-- Pattern Matching Stats (shown when AI is OFF) -->
                <div id="pattern-stats-section" class="generate-stats">
                    <p>Found <strong id="gen-total-count">0</strong> potential flashcards:</p>
                    <div class="gen-breakdown">
                        <div><i class="fas fa-heading"></i> From headings: <span id="gen-heading-count">0</span></div>
                        <div><i class="fas fa-book"></i> From definitions: <span id="gen-def-count">0</span></div>
                        <div><i class="fas fa-list"></i> From lists: <span id="gen-list-count">0</span></div>
                        <div><i class="fas fa-code"></i> From code: <span id="gen-code-count">0</span></div>
                    </div>
                </div>

                <div class="generate-preview">
                    <h3>Preview:</h3>
                    <ul id="generate-preview-list"></ul>
                </div>
                <div class="generate-actions">
                    <button id="generate-cancel-btn" class="action-btn">Cancel</button>
                    <button id="generate-confirm-btn" class="action-btn primary">
                        <i class="fas fa-magic"></i> <span id="generate-btn-text">Generate All</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Card Modal -->
    <div id="add-card-modal" class="modal">
        <div class="modal-content add-card-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus"></i> Add Flashcard</h2>
                <button id="add-card-close" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="add-card-body">
                <div class="form-group">
                    <label for="card-question">Question:</label>
                    <textarea id="card-question" rows="3" placeholder="Enter the question..."></textarea>
                </div>
                <div class="form-group">
                    <label for="card-answer">Answer:</label>
                    <textarea id="card-answer" rows="5" placeholder="Enter the answer..."></textarea>
                </div>
                <div class="add-card-actions">
                    <button id="save-card-btn" class="action-btn primary">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/flashcards.js"></script>
    <script src="js/ai-flashcard-generator.js"></script>
    <script src="js/flashcard-manager-ui.js"></script>
</body>

</html>
